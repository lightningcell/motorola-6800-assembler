# Util Package Documentation

The `assembler.util` package provides utility classes for file I/O operations and common helper functions used throughout the Motorola 6800 Assembler project.

## Package Overview

This package contains utility classes that handle file operations, including:
- Loading and saving assembly source files
- Exporting machine code in various formats (binary, Intel HEX)
- Creating assembly listing files
- File management utilities

## Classes

### FileManager

**Purpose**: Central utility class for all file I/O operations in the assembler.

**Key Responsibilities**:
- Load assembly source code from text files
- Save assembly source code to text files
- Export machine code in binary format
- Export machine code in Intel HEX format
- Generate assembly listing files with line-by-line mapping
- Create example assembly programs
- Provide file utility functions

**Key Methods**:

#### Source Code Operations
```java
public static String loadSourceFile(String filePath) throws IOException
```
- Loads assembly source code from a file
- Returns the complete source as a string
- Used by the UI to load user programs

```java
public static void saveSourceFile(String filePath, String sourceCode) throws IOException
```
- Saves assembly source code to a text file
- Used for saving user work and creating example files

#### Machine Code Export
```java
public static void saveBinaryFile(String filePath, Map<Integer, List<Integer>> machineCode) throws IOException
```
- Exports machine code as a binary file
- Creates a contiguous memory image from address/byte mappings
- Useful for loading into actual hardware or emulators

```java
public static void saveHexFile(String filePath, Map<Integer, List<Integer>> machineCode) throws IOException
```
- Exports machine code in Intel HEX format
- Industry standard format for transferring machine code
- Includes address information and checksums

#### Documentation and Listing
```java
public static void saveListingFile(String filePath, List<Object> assemblyLines) throws IOException
```
- Creates an assembly listing file
- Shows line-by-line mapping of source to machine code
- Includes addresses, machine code bytes, and original source
- Essential for debugging and verification

#### Utility Functions
```java
public static void createExampleProgram(String filePath) throws IOException
```
- Creates a sample 6800 assembly program
- Demonstrates basic programming constructs
- Useful for testing and learning

```java
public static String getFileExtension(String filePath)
public static boolean fileExists(String filePath)
public static void backupFile(String filePath) throws IOException
```
- Common file utility functions
- Used throughout the application for file management

## Usage Examples

### Loading an Assembly Program
```java
try {
    String sourceCode = FileManager.loadSourceFile("program.asm");
    // Process the source code...
} catch (IOException e) {
    System.err.println("Error loading file: " + e.getMessage());
}
```

### Saving Machine Code
```java
Map<Integer, List<Integer>> machineCode = codeGenerator.generateCode(instructions);

// Save as binary
FileManager.saveBinaryFile("program.bin", machineCode);

// Save as Intel HEX
FileManager.saveHexFile("program.hex", machineCode);
```

### Creating an Assembly Listing
```java
List<AssemblyLine> lines = parser.parseProgram(sourceCode);
FileManager.saveListingFile("program.lst", lines);
```

## File Formats Supported

### Assembly Source (.asm, .s)
- Plain text files containing 6800 assembly code
- Comments begin with semicolon (;)
- Supports labels, instructions, and pseudo-ops

### Binary Output (.bin)
- Raw binary machine code
- Contiguous memory image
- Can be loaded directly into memory

### Intel HEX (.hex)
- Industry standard ASCII format
- Includes address information and checksums
- Self-documenting and error-detecting

### Assembly Listing (.lst)
- Human-readable program listing
- Shows address, machine code, and source for each line
- Essential for debugging and verification

## Error Handling

The FileManager class uses standard Java I/O exceptions:
- `IOException`: For file read/write errors
- Graceful handling of missing files
- Automatic backup creation before overwriting files

## Integration with Other Packages

### With Parser Package
- Loads source files that the parser processes
- Saves listing files with parsed line information

### With Assembler Package
- Exports machine code generated by CodeGenerator
- Handles various output formats for different use cases

### With UI Package
- Provides file operations for the user interface
- Supports loading/saving user projects

## Example Programs

The `createExampleProgram()` method generates sample code that demonstrates:
- Basic 6800 assembly syntax
- Label usage and memory organization
- Simple loop and arithmetic operations
- Variable declaration with FCB pseudo-op
- Program structure with ORG and END

## Future Enhancements

Potential improvements to the util package:
- Support for additional file formats (S-record, etc.)
- Compression support for large programs
- Integration with version control systems
- Enhanced listing formats with cross-references
- Batch processing capabilities

## Testing

Unit tests should verify:
- Correct file loading and saving
- Proper format generation for all export types
- Error handling for invalid files
- Backup functionality
- Example program correctness

## Dependencies

- `java.io.*`: Core I/O operations
- `java.nio.file.*`: Modern file handling
- `java.util.*`: Collections and utilities

The FileManager class has no dependencies on other assembler packages, making it a pure utility class that can be used independently.
